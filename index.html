<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PCI Pal Wrapper</title>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'unsafe-inline';
                 style-src  'self' 'unsafe-inline';
                 frame-src  https://euwest1.pcipalstaging.cloud">
  <style>html,body{margin:0;height:100%;}</style>
</head>
<body>

  <form id="pciForm" method="post" target="pciIframe">
    <input type="hidden" name="x-bearer-token"  id="bt">
    <input type="hidden" name="x-refresh-token" id="rt">
  </form>

  <iframe name="pciIframe"
          style="width:100%;height:100%;border:0;"></iframe>

  <script>
    (function () {
      const qs = new URLSearchParams(window.location.search);
      const sid  = qs.get('sid');
      const bt   = qs.get('bt');
      const rt   = qs.get('rt');

      if (!sid || !bt || !rt) {
        document.body.textContent = 'Missing sid, bt, or rt parameters.';
        return;
      }

      const form = document.getElementById('pciForm');
      form.action =
        'https://genesys-service.pcipal.cloud/purecloud/v3/widget.html?pcConversationId={{gcConversationId}}&pcEnvironment=mypurecloud.ie&writeSessionId=true&authDataAction=custom_-_59d53244-2622-4ae5-9383-b5dd7b41ad24&sessionDataAction=custom_-_6dd710d8-0b69-442e-bfda-d1efaac8e9b6&tenantId=1201&environment=pcipalstaging.cloud&region=euwest1' +
        sid +
        '/framed';

      document.getElementById('bt').value = bt;
      document.getElementById('rt').value = rt;
      form.submit();
    })();
  </script>
</body>
</html>

