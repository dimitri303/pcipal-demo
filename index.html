<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PCI Pal Session Wrapper</title>
  <!-- Optional: tighten framing to PCI Pal only -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; frame-src https://euwest1.pcipalstaging.cloud">
  <style>html,body{margin:0;height:100%;}</style>
</head>
<body>

  <!-- Empty form: JS will insert tokens + session URL and post -->
  <form id="pciForm" method="post" target="pciIframe">
    <input type="hidden" name="x-bearer-token"  id="bt">
    <input type="hidden" name="x-refresh-token" id="rt">
  </form>

  <!-- iFrame displays the PCI Pal payment UI -->
  <iframe name="pciIframe"
          style="width:100%;height:100%;border:0;"></iframe>

  <script>
    (function () {
      const qs = new URLSearchParams(window.location.search);

      // Values passed from the Genesys Script
      const sessionId   = qs.get('sid');   // GUID from Data Action 2
      const bearerToken = qs.get('bt');    // access token
      const refreshToken= qs.get('rt');    // refresh token

      if (!sessionId || !bearerToken || !refreshToken) {
        document.body.innerHTML =
          '<p style="padding:1rem;font-family:sans-serif;color:#c00;">' +
          'Missing sid, bt, or rt query-string parameters.</p>';
        return;
      }

      // Build the full framed URL (tenant 1201 in euwest1)
      const actionUrl = 
        'https://euwest1.pcipalstaging.cloud/session/1201/view/' +
        sessionId +
        '/framed';

      // Populate hidden fields and submit
      document.getElementById('bt').value = bearerToken;
      document.getElementById('rt').value = refreshToken;

      const form = document.getElementById('pciForm');
      form.action = actionUrl;
      form.submit();
    })();
  </script>
</body>
</html>
