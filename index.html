<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PCI Pal Wrapper â€“ Hard-coded URL</title>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; frame-src https://euwest1.pcipalstaging.cloud">
  <style>html,body{margin:0;height:100%;}</style>
</head>
<body>

  <!-- Hidden form; JS fills sessionId & tokens then auto-posts -->
  <form id="pciForm" method="post" target="pciIframe">
    <input type="hidden" name="x-bearer-token"  id="bt">
    <input type="hidden" name="x-refresh-token" id="rt">
  </form>

  <iframe name="pciIframe"
          style="width:100%;height:100%;border:0;"></iframe>

  <script>
    (function () {
      const qs = new URLSearchParams(window.location.search);
      const sessionId   = qs.get('sid');   // only the GUID from Data Action 2
      const bearerToken = qs.get('bt');    // bearer token
      const refreshToken= qs.get('rt');    // refresh token

      if (!sessionId || !bearerToken || !refreshToken) {
        document.body.innerHTML =
          '<p style="padding:1rem;font-family:sans-serif;color:#c00;">' +
          'Missing sid, bt, or rt query-string parameters.</p>';
        return;
      }

      // Build the full framed URL (tenant 1201, euwest1 staging)
      const actionUrl =
        'https://euwest1.pcipalstaging.cloud/session/1201/view/' +
        sessionId +
        '/framed';

      // Populate form and submit
      const form = document.getElementById('pciForm');
      document.getElementById('bt').value = bearerToken;
      document.getElementById('rt').value = refreshToken;
      form.action = actionUrl;
      form.submit();
    })();
  </script>
</body>
</html>
