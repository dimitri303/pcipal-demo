<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PCI Pal Wrapper</title>
  <!-- Lock the page to itself and PCI Pal only -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; frame-src https://*.pcipal*.cloud">
  <style>
    html,body {margin:0;height:100%;}  /* full-height iframe */
  </style>
</head>
<body>

  <!-- Empty form; JS will fill it and submit -->
  <form id="pciForm" method="post" target="pciIframe">
    <input type="hidden" name="x-bearer-token"  id="bt">
    <input type="hidden" name="x-refresh-token" id="rt">
  </form>

  <!-- Where the PCI Pal UI will appear -->
  <iframe name="pciIframe"
          style="width:100%;height:100%;border:0;"></iframe>

  <script>
    (function () {
      // Grab ?url=  ?bt=  ?rt=  from the query string
      const qs = new URLSearchParams(window.location.search);
      const sessionUrl  = qs.get('url');   // framed URL
      const bearerToken = qs.get('bt');    // JWT
      const refreshToken= qs.get('rt');    // refresh

      // Basic validation
      if (!sessionUrl || !bearerToken || !refreshToken) {
        document.body.innerHTML =
          '<p style="padding:1rem;color:#c00;font-family:sans-serif;">' +
          'PCI Pal wrapper: one or more required query parameters ' +
          '(<code>url</code>, <code>bt</code>, <code>rt</code>) are missing.</p>';
        return;
      }

      // Populate form fields
      document.getElementById('bt').value = bearerToken;
      document.getElementById('rt').value = refreshToken;

      // Ensure action points to the framed URL
      const form = document.getElementById('pciForm');
      form.action = sessionUrl;                    // must already include /framed

      // Auto-submit
      form.submit();
    })();
  </script>
</body>
</html>
